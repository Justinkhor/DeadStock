<div id="item-show">
  <div class="row">
    <div class="item-header">
        <%= @item.name %>
      <%= @item.color %>
    </div>
  </div>


  <div class="item-symbols">
    <p>
      TICKER: <%= @item.model_number %> | CONDITION: DEADSTOCK
    </p>
  </div>
  <div class="row">
    <div class="item-options col-sm-3">
      <div class="row">
        <p>
          SIZE
        </p>
        <select id="soflow">
          <option>
            Select Size
          </option>
          <option value="6">6</option>
          <option value="7">7</option>
          <option value="8">8</option>
          <option value="9">9</option>
          <option value="10">10</option>
          <option value="11">11</option>
          <option value="12">12</option>
        </select>
      </div>
    </div>
    <div class="item-options col-sm-3">
      <p>
        LAST SALE
      </p>

    </div>
    <div class="item-options col-sm-3">

      <p>
        LOWEST ASK
      </p>
      <% if !@item.stocks.empty? %>
      <p>
        RM<%= @stock.resell_price %>
      </p>
      <%= button_to "BUY", new_item_stock_bid_path(@item, @item.stocks.order('resell_price DESC').last), class:"myButton", method: "get"%>

      <% else %>
      <p>
        SORRY! NO STOCK AVAILABLE AT THE MOMENT.
      </p>
      <% end %>
    </div>
    <div class="item-options col-sm-3">
      <p>
        HIGHEST BID
      </p>
      <% if @stock != nil %>
      <% if !@stock.bids.empty? %>
      <p>
        RM<%=  @stock.bids.order('bidding_price ASC').last.bidding_price %>
      </p>
      <% else %>
      <p>
        THERE ARE NO BIDS AT THE MOMENT.
      </p>
      <% end %>
      <% end %>
      <%= button_to "SELL", new_item_stock_path(@item), class:"myButton2", method: "get"%>
    </div>
  </div>

  <% if @errors.present? %>
  <p><% @errors.each do |x| %>
    <%= x %>
      <% end %>
  </p>
  <%end%>
  <div class="row">
    <div class="col-md-offset-3 col-md-6">
          <% @item.images.each do |i| %>
                <%= image_tag i.image.url, style:"width: 100%" %>
          <% end %>
    </div>
  </div>
  <br />

  <div class="item-description col-sm-4">
    <p>
      <strong>COLORWAY: </strong><%= @item.color %>
    </p>
  </div>
  <div class="item-description col-sm-4">
    <p>
      <strong>RETAIL PRICE: </strong><%= @item.retail_price %> (RM<%= (@item.retail_price * 4.36).to_i %>)
    </p>
  </div>
  <div class="item-description col-sm-4">
    <p>
      <strong>RELEASE DATE: </strong><%= @item.release_date %>
    </p>
  </div>
  <br>
  <table>
    <tr>
      <th>Sale Price (USD)</th>
      <th>Sale Price (MYR)</th>
      <th>Date/Time</th>
    </tr>
    <tr>
      <% @table.first(5).each do |y| %>
      <td><%= y.transacted_price %></td>
      <td><%= y.transacted_price_myr %></td>
      <td><%= y.date_time %></td>
    </tr>
    <% end %>
  </table>

  <br>
  <table>
<div class="graph col-sm-4 col-sm-offset-2 col-md-6">
  <% x = HistoricalTable.uniq.pluck(:model_number) %>
      <% if x.include?(@item.model_number) %>
        <%= area_chart HistoricalTable.where(model_number: @item.model_number).group(:date_time).maximum(:transacted_price_myr) %>
      <% end %>

</div>
</table>
<h1> Historical </h1>
  <% @table.first(1).each do |x| %>
<p> # OF SALES : <%= @table.size %> </p>
<p> Price Premium : <%= (((x.transacted_price - @item.retail_price)/@item.retail_price.to_f) * 100).round(2) %>%</p>
  <% end %>
  <% sum = 0 %>
  <% @table.each do |x| %>
    <% sum  += x.transacted_price %>
  <% end %>
<p>Average Sale Price(USD) : <%= (sum/@table.size) %></p>
<p>Average Sale Price(MYR) : <%= ((sum/@table.size) * 4.36).to_i %></p>
  <br>

</div>

<% if signed_in? %>
  <% if current_user.role != "admin"%>
    <%= link_to "Sell", new_item_stock_path(@item) %> |
  <% else %>
    <h3>Stocks:</h3>
    <br>
    <table>
      <tr>
        <th>Id</th>
        <th>Username</th>
        <th>Gender</th>
        <th>Size</th>
        <th>Resell Price</th>
        <th>Closing Date</th>
        <th></th>
        <th></th>
      </tr>
      <% @item.stocks.each do |stock| %>
      <tr>
      <td><%= stock.id %></td>
      <td><%= stock.user.username %></td>
      <td><%= stock.gender %></td>
      <td><%= stock.size %></td>
      <td><%= stock.resell_price %></td>
      <td><%= stock.closing_date %></td>
      <td><%= link_to "Edit", edit_item_stock_path(@item, stock.id) %></td>
      <td><%= link_to "Delete", method: :delete %></td>
      </tr>
      <% end %>
    </table>
    <br>

  <%= link_to 'Edit', edit_item_path(@item) %> |

  <% end %>
<% end %>
<%= link_to 'Back', root_path %>
<br><br><br>

<style>
select#soflow, select#soflow-color {
   -webkit-appearance: button;
   -webkit-border-radius: 2px;
   -webkit-box-shadow: 0px 1px 3px rgba(0, 0, 0, 0.1);
   -webkit-padding-end: 20px;
   -webkit-padding-start: 2px;
   -webkit-user-select: none;
   background-image: url(http://i62.tinypic.com/15xvbd5.png), -webkit-linear-gradient(#FAFAFA, #F4F4F4 40%, #E5E5E5);
   background-position: 97% center;
   background-repeat: no-repeat;
   border: 1px solid #AAA;
   color: #555;
   font-size: inherit;
   margin: 20px;
   overflow: hidden;
   padding: 10px 10px;
   text-overflow: ellipsis;
   white-space: nowrap;
   width: 100px;
}
</style>
